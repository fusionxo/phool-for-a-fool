<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Living Sunflower</title>
    <style>
        :root {
            /* Night Theme Palette */
            --sky-top: #0f2027;
            --sky-bottom: #203a43;
            --stem-color: #2d4c1e;
            --stem-shadow: #1a2f11;
            --petal-color-1: #FFD700;
            --petal-color-2: #FF8C00;
            --seed-center: #1a0f0a;
            --seed-outer: #3e2723;
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            /* Deep Night Gradient */
            background: linear-gradient(to bottom, #0f0c29, #302b63, #24243e);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* Ambient Background Overlay for warmth */
        .atmosphere {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* Moonlight Spotlight */
            background: radial-gradient(circle at 50% 50%, rgba(40, 50, 80, 0.4) 0%, rgba(10, 10, 20, 0.8) 80%);
            pointer-events: none;
            z-index: 1;
        }

        /* Canvas for Pollen Particles */
        #pollen-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            pointer-events: none;
        }

        /* Main Container */
        .garden {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            z-index: 3;
            perspective: 1000px;
        }

        /* The Stem (SVG) */
        .stem-container {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: visible;
            z-index: 4;
            filter: drop-shadow(0 0 10px rgba(0,0,0,0.5));
        }

        /* The Flower Head Container */
        .flower-head-wrapper {
            position: absolute;
            /* Start position, will be updated by JS */
            left: 50%;
            top: 40%; 
            width: 0;
            height: 0;
            z-index: 5;
            transform-style: preserve-3d;
            cursor: pointer;
        }

        /* The actual rotatable flower head */
        .flower-head {
            position: relative;
            width: 260px;
            height: 260px;
            background: radial-gradient(circle at center, var(--seed-center) 20%, var(--seed-outer) 100%);
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(0); /* Start hidden for bloom */
            transition: box-shadow 0.3s ease, filter 0.3s ease;
            box-shadow: 
                0 0 60px rgba(255, 140, 0, 0.15),
                inset 0 0 20px rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .flower-head.bloomed {
            animation: bloom-bounce 1.2s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        .flower-head:hover {
            filter: brightness(1.2) drop-shadow(0 0 15px rgba(255, 215, 0, 0.6));
            box-shadow: 
                0 0 80px rgba(255, 165, 0, 0.4),
                inset 0 0 20px rgba(0,0,0,0.5);
        }

        /* Seeds - generated by JS */
        .seed {
            position: absolute;
            background-color: #1a100c;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 1px 1px 0px rgba(255,255,255,0.05);
        }

        /* Petals */
        .petal {
            position: absolute;
            bottom: 50%;
            left: 50%;
            width: 50px;
            height: 140px;
            background: linear-gradient(to top, var(--petal-color-2), var(--petal-color-1));
            border-radius: 50% 50% 10% 10% / 80% 80% 20% 20%;
            transform-origin: bottom center;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            filter: drop-shadow(0 0 5px rgba(255, 165, 0, 0.3));
            z-index: -1;
            opacity: 0; /* Hidden before bloom */
            transition: transform 0.1s;
        }

        /* Petal details (veins) */
        .petal::after {
            content: '';
            position: absolute;
            top: 10%;
            left: 50%;
            width: 2px;
            height: 60%;
            background: rgba(0,0,0,0.1);
            transform: translateX(-50%);
            border-radius: 2px;
        }

        .petal.layer-back {
            width: 60px;
            height: 160px;
            background: linear-gradient(to top, #b35900, #ff8c00);
            z-index: -2;
            filter: brightness(0.8);
        }

        /* Leaves attached to stem logic */
        .leaf {
            position: absolute;
            width: 80px;
            height: 40px;
            background: linear-gradient(45deg, var(--stem-shadow), var(--stem-color));
            border-radius: 0 80% 0 80%;
            box-shadow: 2px 4px 8px rgba(0,0,0,0.2);
            transform-origin: 0 50%;
            pointer-events: none;
            z-index: 4;
            opacity: 0;
            transition: opacity 1s ease 1s;
        }
        
        .leaf.visible {
            opacity: 1;
        }

        /* Animations */
        @keyframes bloom-bounce {
            0% { transform: translate(-50%, -50%) scale(0); }
            60% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        @keyframes petal-bloom {
            0% { transform: translateX(-50%) rotate(var(--r)) scale(0); opacity: 0; }
            100% { transform: translateX(-50%) rotate(var(--r)) scale(1); opacity: 1; }
        }
        
        /* Mobile Instructions */
        .hint {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            color: rgba(255,255,255,0.4);
            font-size: 0.9rem;
            pointer-events: none;
            z-index: 10;
            text-shadow: 0 1px 2px rgba(0,0,0,0.8);
            opacity: 0;
            animation: fadeIn 2s ease 3s forwards;
        }

        @keyframes fadeIn { to { opacity: 1; } }

    </style>
</head>
<body>

    <div class="atmosphere"></div>
    
    <!-- Canvas for Pollen -->
    <canvas id="pollen-canvas"></canvas>

    <div class="garden" id="garden">
        <!-- SVG for the organic stem curve -->
        <svg class="stem-container" id="stem-svg">
            <!-- Filter for slight noise/texture on stem -->
            <defs>
                <filter id="displacementFilter">
                    <feTurbulence type="turbulence" baseFrequency="0.05" numOctaves="2" result="turbulence"/>
                    <feDisplacementMap in2="turbulence" in="SourceGraphic" scale="2" xChannelSelector="R" yChannelSelector="G"/>
                </filter>
            </defs>
            <path id="stem-path" d="" fill="none" stroke="#2d4c1e" stroke-width="18" stroke-linecap="round" filter="url(#displacementFilter)" />
        </svg>

        <!-- Dynamic Leaves -->
        <div id="leaf-1" class="leaf"></div>
        <div id="leaf-2" class="leaf"></div>

        <!-- The Flower Head -->
        <div class="flower-head-wrapper" id="flower-wrapper">
            <div class="flower-head" id="flower-head">
                <!-- Petals and seeds will be injected here -->
            </div>
        </div>
    </div>

    <div class="hint">Move your mouse or touch to interact</div>

    <script>
        /**
         * CONFIGURATION
         */
        const CONFIG = {
            petalCount: 24,
            layerCount: 2,
            seedCount: 180,
            stemColor: '#2d4c1e',
            stemWidth: 20,
            swaySpeed: 0.002,
            swayRange: 30, // Max pixels stem moves
            mouseInfluence: 0.1, // Lerp speed
        };

        /**
         * ELEMENTS
         */
        const garden = document.getElementById('garden');
        const flowerHead = document.getElementById('flower-head');
        const flowerWrapper = document.getElementById('flower-wrapper');
        const stemPath = document.getElementById('stem-path');
        const leaf1 = document.getElementById('leaf-1');
        const leaf2 = document.getElementById('leaf-2');
        const pollenCanvas = document.getElementById('pollen-canvas');
        const ctx = pollenCanvas.getContext('2d');

        /**
         * STATE
         */
        let dimensions = { w: window.innerWidth, h: window.innerHeight };
        let mouse = { x: dimensions.w / 2, y: dimensions.h / 2 };
        let target = { x: dimensions.w / 2, y: dimensions.h * 0.4 }; // Where the flower wants to go
        let current = { x: dimensions.w / 2, y: dimensions.h * 0.4 }; // Where the flower is
        let time = 0;
        let particles = [];

        /**
         * INITIALIZATION
         */
        function init() {
            resize();
            createFlowerStructure();
            createParticles();
            
            // Event Listeners
            window.addEventListener('resize', resize);
            window.addEventListener('mousemove', handleInput);
            window.addEventListener('touchmove', (e) => handleInput(e.touches[0]));
            
            // Start Animation Loop
            requestAnimationFrame(animate);

            // Trigger Bloom
            setTimeout(() => {
                flowerHead.classList.add('bloomed');
                bloomPetals();
                leaf1.classList.add('visible');
                leaf2.classList.add('visible');
            }, 500);
        }

        function resize() {
            dimensions.w = window.innerWidth;
            dimensions.h = window.innerHeight;
            pollenCanvas.width = dimensions.w;
            pollenCanvas.height = dimensions.h;
            
            // Reset flower slightly on resize
            current.y = dimensions.h * 0.4;
        }

        function handleInput(e) {
            mouse.x = e.clientX;
            mouse.y = e.clientY;
        }

        /**
         * PROCEDURAL GENERATION
         */
        function createFlowerStructure() {
            // 1. Create Seeds (Fibonacci Spiral)
            const phi = 137.5; // Golden Angle
            const maxRadius = 120; // Size of seed area
            
            for (let i = 0; i < CONFIG.seedCount; i++) {
                const angle = i * phi * (Math.PI / 180);
                const r = 4 * Math.sqrt(i); // Spread factor
                const x = r * Math.cos(angle);
                const y = r * Math.sin(angle);
                
                // Keep seeds within the head
                if (r > 60) continue; // Safety clip

                const seed = document.createElement('div');
                seed.classList.add('seed');
                
                // Size varies slightly
                const size = 3 + Math.random() * 3;
                seed.style.width = `${size}px`;
                seed.style.height = `${size}px`;
                seed.style.left = `calc(50% + ${x}px)`;
                seed.style.top = `calc(50% + ${y}px)`;
                
                // Color variation
                const lightness = 10 + Math.random() * 15;
                seed.style.backgroundColor = `hsl(25, 40%, ${lightness}%)`;
                
                flowerHead.appendChild(seed);
            }

            // 2. Create Petals
            for (let layer = 0; layer < CONFIG.layerCount; layer++) {
                const count = CONFIG.petalCount + (layer * 8);
                
                for (let i = 0; i < count; i++) {
                    const angle = (360 / count) * i + (layer * 15); // Offset layers
                    const petal = document.createElement('div');
                    petal.classList.add('petal');
                    if (layer === 0) petal.classList.add('layer-back');
                    
                    // Set custom property for animation
                    petal.style.setProperty('--r', `${angle}deg`);
                    
                    // Initial Transform (will be animated by keyframes)
                    petal.style.transform = `translateX(-50%) rotate(${angle}deg) scale(0)`;
                    
                    flowerHead.appendChild(petal);
                }
            }
        }

        function bloomPetals() {
            const petals = document.querySelectorAll('.petal');
            petals.forEach((p, index) => {
                // Staggered bloom
                const delay = index * 0.05;
                p.style.animation = `petal-bloom 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards ${delay}s`;
            });
        }

        /**
         * ANIMATION LOOP
         */
        function animate() {
            time += 1;

            // 1. Physics: Calculate Target Position based on Mouse & Wind
            // The flower tries to look at the mouse, but is anchored
            // We map mouse X to a constrained range around the center
            const xLimit = dimensions.w * 0.3;
            const yLimit = dimensions.h * 0.1;
            
            let desiredX = (mouse.x - dimensions.w / 2);
            // Clamp movement
            desiredX = Math.max(-xLimit, Math.min(xLimit, desiredX));
            
            // Add wind (Sine wave)
            const wind = Math.sin(time * CONFIG.swaySpeed) * CONFIG.swayRange;
            
            // Set target absolute coords
            target.x = (dimensions.w / 2) + desiredX + wind;
            
            // Y position is mostly static but bobs slightly with wind
            target.y = (dimensions.h * 0.4) + Math.cos(time * CONFIG.swaySpeed * 2) * 10;

            // Smoothly move 'current' towards 'target' (Lerp)
            current.x += (target.x - current.x) * CONFIG.mouseInfluence;
            current.y += (target.y - current.y) * CONFIG.mouseInfluence;

            // 2. Update Flower Head Position
            flowerWrapper.style.left = `${current.x}px`;
            flowerWrapper.style.top = `${current.y}px`;

            // 3. 3D Rotation of Head to "look" at cursor
            // Calculate angle
            const deltaX = mouse.x - current.x;
            const deltaY = mouse.y - current.y;
            const rotateY = (deltaX / dimensions.w) * 40; // Max 40deg rotation
            const rotateX = -(deltaY / dimensions.h) * 40;

            flowerHead.style.transform = `translate(-50%, -50%) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;

            // 4. Update Stem (BÃ©zier Curve)
            // Start: Bottom Center
            // Control Point: Calculated to create a nice curve
            // End: Flower Head Base
            const startX = dimensions.w / 2;
            const startY = dimensions.h;
            const endX = current.x;
            const endY = current.y + 130; // Attach to bottom of flower head (radius is 130)

            // Control point logic: It should lag behind slightly to creating bowing effect
            const cp1x = startX;
            const cp1y = startY - (startY - endY) * 0.5;
            const cp2x = endX;
            const cp2y = endY + (startY - endY) * 0.3;

            // Draw Cubic Bezier for smoother S-curve
            const d = `M ${startX} ${startY} C ${cp1x} ${cp1y}, ${cp2x} ${cp2y}, ${endX} ${endY}`;
            stemPath.setAttribute('d', d);

            // 5. Update Leaves
            // Place leaves along the curve approximation
            // Leaf 1 (Lower)
            const l1x = startX + (endX - startX) * 0.3;
            const l1y = startY + (endY - startY) * 0.3;
            leaf1.style.left = `${l1x}px`;
            leaf1.style.top = `${l1y}px`;
            leaf1.style.transform = `rotate(${desiredX * 0.1 - 45}deg)`;

            // Leaf 2 (Higher)
            const l2x = startX + (endX - startX) * 0.6;
            const l2y = startY + (endY - startY) * 0.6;
            leaf2.style.left = `${l2x}px`;
            leaf2.style.top = `${l2y}px`;
            leaf2.style.transform = `scaleX(-1) rotate(${-(desiredX * 0.1) - 45}deg)`; // Flipped

            // 6. Canvas Particles
            drawParticles();

            requestAnimationFrame(animate);
        }

        /**
         * PARTICLE SYSTEM (Pollen/Atmosphere)
         */
        function createParticles() {
            for(let i=0; i<100; i++) {
                particles.push({
                    x: Math.random() * dimensions.w,
                    y: Math.random() * dimensions.h,
                    size: Math.random() * 2 + 0.5,
                    speedY: Math.random() * 0.3 + 0.05,
                    speedX: (Math.random() - 0.5) * 0.5,
                    opacity: Math.random() * 0.5 + 0.1,
                    pulseSpeed: Math.random() * 0.05 + 0.01,
                    pulseOffset: Math.random() * Math.PI * 2
                });
            }
        }

        function drawParticles() {
            ctx.clearRect(0, 0, dimensions.w, dimensions.h);
            
            ctx.fillStyle = "#FFD700"; // Gold fireflies
            
            particles.forEach(p => {
                // Update
                p.y -= p.speedY; // Float up
                p.x += p.speedX + Math.sin(time * 0.01 + p.y) * 0.2; // Wiggle
                
                // Wrap around
                if (p.y < -10) p.y = dimensions.h + 10;
                if (p.x < -10) p.x = dimensions.w + 10;
                if (p.x > dimensions.w + 10) p.x = -10;

                // Pulsing
                const pulse = (Math.sin(time * p.pulseSpeed + p.pulseOffset) + 1) / 2;
                const activeOpacity = p.opacity * 0.5 + (pulse * 0.5);

                // Draw with glow
                ctx.globalAlpha = activeOpacity;
                ctx.shadowBlur = p.size * 5;
                ctx.shadowColor = "#ffb300";
                
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
            });
            
            ctx.shadowBlur = 0; // Reset
            
            // Add Moon glow
            ctx.globalAlpha = 0.08;
            const gradient = ctx.createRadialGradient(
                dimensions.w * 0.5, dimensions.h * 0.3, 0,
                dimensions.w * 0.5, dimensions.h * 0.3, 600
            );
            gradient.addColorStop(0, "rgba(200, 220, 255, 0.3)");
            gradient.addColorStop(1, "transparent");
            ctx.fillStyle = gradient;
            ctx.fillRect(0,0, dimensions.w, dimensions.h);
            
            ctx.globalAlpha = 1.0;
        }

        // Run
        init();

    </script>
</body>
</html>